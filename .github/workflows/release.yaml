name: Release
on:
  workflow_dispatch:
  release:
    types: [published]

permissions:
  contents: read

jobs:
  release:
    permissions:
      id-token: write
      contents: read
      attestations: write
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false

    steps:

    - name: Check out repository
      uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4.1.7
      with:
        fetch-depth: 0

    # Use Oracle Java SE for compiling.
    - name: Setup Oracle Java SE
      uses: oracle-actions/setup-java@83e2004a40aaa491fbc6b4697353b9a75b095efb # v1.3.4
      with:
        website: oracle.com
        release: '17'

    - name: Build the artifact
      run: ./mvnw source:jar package

    # Build provenance
    - name: Attest Build Provenance
      uses: actions/attest-build-provenance@bdd51370e0416ac948727f861e03c2f05d32d78e # v1.3.2
      with:
        subject-path: ./*/target/*.jar
